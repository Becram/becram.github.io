<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.12.1 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Kubernetes Cluster Management with kops - Bikram’s Blog</title>
<meta name="description" content="Kubernetes Cluster Management with kopsYou may find the complete script here">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Bikram's Blog">
<meta property="og:title" content="Kubernetes Cluster Management with kops">
<meta property="og:url" content="http://0.0.0.0:4000/devops/Kubernetes-Cluster-Mgmt-with-Kops/">


  <meta property="og:description" content="Kubernetes Cluster Management with kopsYou may find the complete script here">



  <meta property="og:image" content="http://0.0.0.0:4000/assets/images/kops.png">



  <meta name="twitter:site" content="@itsbecram">
  <meta name="twitter:title" content="Kubernetes Cluster Management with kops">
  <meta name="twitter:description" content="Kubernetes Cluster Management with kopsYou may find the complete script here">
  <meta name="twitter:url" content="http://0.0.0.0:4000/devops/Kubernetes-Cluster-Mgmt-with-Kops/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="http://0.0.0.0:4000/assets/images/kops.png">
    
  

  



  <meta property="article:published_time" content="2019-07-10T00:00:00+00:00">



  <meta property="article:modified_time" content="2019-04-15T20:00:58+00:00">



  

  


<link rel="canonical" href="http://0.0.0.0:4000/devops/Kubernetes-Cluster-Mgmt-with-Kops/">







  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Bikram Dhoju",
      "url": "http://0.0.0.0:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Bikram's Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/">Bikram's Blog</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/me/" >About me</a>
            </li><li class="masthead__menu-item">
              <a href="/assets/files/BikramDhoju20210202.pdf" >My Resume</a>
            </li><li class="masthead__menu-item">
              <a href="/" >My Blogs</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="http://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="http://0.0.0.0:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="/categories/devops" itemprop="item"><span itemprop="name">Devops</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Kubernetes Cluster Management with kops</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/bio-image.jpg" alt="Bikram Dhoju" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Bikram Dhoju</h3>
    
    
      <p class="author__bio" itemprop="description">
         Site Reliabilty Engineer at SertisCorp Co LTD
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Bangkok, Thailand</span>
        </li>
      

      
        <li>
          <a href="https://bdhoju.com" itemprop="url">
            <i class="fas fa-fw fa-link" aria-hidden="true"></i> Website
          </a>
        </li>
      

      
        <li>
          <a href="mailto:bikram.dhoju@gmail.com">
            <meta itemprop="email" content="bikram.dhoju@gmail.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      

      
        <li>
          <a href="https://twitter.com/itsbecram" itemprop="sameAs">
            <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      
        <li>
          <a href="https://www.facebook.com/becram.dhoju" itemprop="sameAs">
            <i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook
          </a>
        </li>
      

      

      

      

      
        <li>
          <a href="https://instagram.com/becram061" itemprop="sameAs">
            <i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram
          </a>
        </li>
      

      

      

      
        <li>
          <a href="https://github.com/Becram" itemprop="sameAs">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Kubernetes Cluster Management with kops">
    <meta itemprop="description" content="Kubernetes Cluster Management with kopsYou may find the complete script here">
    <meta itemprop="datePublished" content="July 10, 2019">
    <meta itemprop="dateModified" content="April 15, 2019">

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Kubernetes Cluster Management with kops
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> What is here</h4></header>
              <ul class="toc__menu">
  <li><a href="#kubernetes-cluster-management-with-kops">Kubernetes Cluster Management with kops</a>
    <ul>
      <li><a href="#key-features-kops">Key features kops</a>
        <ul>
          <li><a href="#without-further-ado-lets-dive-into-kops-for-this-tutorial-we-will-be-using-aws-cloud">Without further ado lets dive into kops (For this tutorial we will be using AWS cloud)</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
            </nav>
          </aside>
        
        <h1 id="kubernetes-cluster-management-with-kops">Kubernetes Cluster Management with kops</h1>
<p>You may find the complete script <a href="https://gist.github.com/Becram/d68009a56fff139bbfad982ffb5c204f">here</a></p>

<p>After Google donated its amazing container orcheastration tool, kubernetes to Cloud Native Computing foundation (CNCF), many devops breath the air of sigh. Kubernetes with it amazing power took over the devops world which made the devops more powerful, resilient and highly scalable with great implimentation of fault tolerance.</p>

<p>All these power come at a price. For a newbies kubernetes cluster creation seems a additional headache with very steep learning curves. Manual cluster creation seems a great challenge and tedious task. So, this is where the open source <a href="https://github.com/kubernetes/kops">kops</a> comes to g rescue. With plethora of task abstraction, kops is a great tool to create kubernetes cluster. Kops prvides the production ready cluster with high scalability on the popular cloud architecture as AWS and Google cloud. Moreover it has a close ressemblence with <em>kubectl</em> syntax which makes learning very flat.</p>

<h2 id="key-features-kops">Key features kops</h2>

<ul>
  <li>Automates the provisioning of Kubernetes clusters in AWS and GCE</li>
  <li>Deploys Highly Available (HA) Kubernetes Masters</li>
  <li>Built on a state-sync model for <strong>dry-runs</strong> and automatic <strong>idempotency</strong></li>
  <li>Ability to generate Terraform</li>
  <li>Supports custom Kubernetes add-ons</li>
  <li>Command line autocompletion</li>
  <li>YAML Manifest Based API Configuration</li>
  <li>Templating and dry-run modes for creating
 Manifests</li>
  <li>Choose from eight different CNI Networking providers out-of-the-box</li>
  <li>Supports upgrading from kube-up</li>
  <li>Capability to add containers, as hooks, and files to nodes via a cluster manifest</li>
</ul>

<h3 id="without-further-ado-lets-dive-into-kops-for-this-tutorial-we-will-be-using-aws-cloud">Without further ado lets dive into kops (For this tutorial we will be using AWS cloud)</h3>

<p>First thing first make sure you have aws account. So, lets install aws cli as shown below:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    sudo apt-get update
    # install python-pip
    sudo apt install python-pip
    #install AWS client
    pip install awscli --upgrade --user
    #install jq
    sudo apt-get install jq
</code></pre></div></div>
<p>After that make sure you have configured <em>aws cli</em> with appropriate configuration using command <em>aws configure</em></p>

<p>Next we are goiing to install kops. kops installation is very easy</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    # Installing kops version 1.12.2
    wget https://github.com/kubernetes/kops/releases/download/1.12.2/kops-linux-amd64
    chmod +x kops-linux-amd64
    sudo mv kops-linux-amd64 /usr/local/bin/kops
</code></pre></div></div>
<p>We need subdomain name for the cluster which will be the identity of the cluster. Since we dont have  registered subdomain we can have as domain name as <em>becram.k8s.local</em> for our case. All the configuration needs to be stored in the cloud itself for which we use AWS S3 bucket. lets create a S3 buket as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    SUBDOMAIN_NAME=becram.k8s.local
    AWS_DEFAULT_REGION=us-east-2 # I use us-east-2 region
    aws s3 rb s3://$SUBDOMAIN_NAME-kubernetes-state
    aws s3 mb s3://$SUBDOMAIN_NAME-kubernetes-state --region $AWS_DEFAULT_REGION
    export KOPS_STATE_STORE=s3://$SUBDOMAIN_NAME-kubernetes-state
</code></pre></div></div>
<p>Next we need to have a ssh keys to access the server nodes. We create  keys as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    KOPS_HOME=/home/bikram/kops
    SSH_KEY_HOME=$KOPS_HOME/$SUBDOMAIN_NAME/sshkeys
    # create ssh key home
    mkdir $SSH_KEY_HOME
    # generate ssh key
    ssh-keygen -f $SSH_KEY_HOME/id_rsa -t rsa #save the key in the sshkeys
</code></pre></div></div>

<p>Finally lets the party begin. lets run the cluster as</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    SSH_PUBLIC_KEY=$SSH_KEY_HOME/id_rsa.pub
    kops create cluster --v=0 \
        --cloud=aws \
        --node-count 2 \
        --master-size=t2.medium \
        --master-zones=us-east-2a \
        --zones us-east-2a,us-east-2b \
        --name=$SUBDOMAIN_NAME \
        --node-size=t2.micro \
        --ssh-public-key=$SSH_PUBLIC_KEY \
        2&gt;&amp;1 | tee $KOPS_HOME/create_cluster.txt

    kops update cluster $SUBDOMAIN_NAME --yes
    ############# UPDATE CLUSTER ENDS ################"

</code></pre></div></div>
<p>Your cluster is ready.</p>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/kubernetes" class="page__taxonomy-item" rel="tag">Kubernetes</a><span class="sep">, </span>
    
      
      
      <a href="/tags/orcheastration" class="page__taxonomy-item" rel="tag">Orcheastration</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/devops" class="page__taxonomy-item" rel="tag">DevOps</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-04-15">April 15, 2019</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=itsbecram&text=Kubernetes+Cluster+Management+with+kops%20http%3A%2F%2F0.0.0.0%3A4000%2Fdevops%2FKubernetes-Cluster-Mgmt-with-Kops%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2F0.0.0.0%3A4000%2Fdevops%2FKubernetes-Cluster-Mgmt-with-Kops%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http%3A%2F%2F0.0.0.0%3A4000%2Fdevops%2FKubernetes-Cluster-Mgmt-with-Kops%2F" class="btn btn--google-plus" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Google Plus"><i class="fab fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2F0.0.0.0%3A4000%2Fdevops%2FKubernetes-Cluster-Mgmt-with-Kops%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/network&system/Imgur-imagfe-uploader-flask-Python/" class="pagination--pager" title="Python(Flask) Project (Service to upload image to imgur.com)
">Previous</a>
    
    
      <a href="/devops/Kustomized-Helm/" class="pagination--pager" title="Kustomized Helm Structure
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/webhook-k8s-pt-2.jpeg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/devops/Building-Kubernetes-Admission-Webhooks-pt-2/" rel="permalink">Building Kubernetes Admission Webhooks (Part 2 of 2)
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">
  
    
      SN
      Stack
      Technology
    
  
  
    
      1
      Language
      Golang
    
    
      2
      Orchestrator
      Kubernetes(KinD...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/webhook-k8s-pt-1.jpeg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/devops/Building-Kubernetes-Admission-Webhooks-pt-1/" rel="permalink">Building Kubernetes Admission Webhooks (Part 1 of 2)
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">
  
    
      SN
      Stack
      Technology
    
  
  
    
      1
      Language
      Golang
    
    
      2
      Orchestrator
      Kubernetes(KinD...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/kustomized_helm.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/devops/Kustomized-Helm/" rel="permalink">Kustomized Helm Structure
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">
  
    
      SN
      Stack
      Technology
    
  
  
    
      1
      Language
      yaml
    
    
      2
      Templating
      Helm/Kustomize
    ...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/pythonfeatured.jpg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/network&system/Imgur-imagfe-uploader-flask-Python/" rel="permalink">Python(Flask) Project (Service to upload image to imgur.com)
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Imgur REST Image Uploader

</p>
  </article>
</div>
        
      </div>
    </div>
  
  
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><input type="text" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
    <div id="results" class="results"></div></div>
      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/itsbecram"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
      <li><a href="https://www.facebook.com/becram.dhoju"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
    
    
      <li><a href="https://github.com/Becram"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    
    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-125305854-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-125305854-1');
</script>


<div class="page__footer-copyright">&copy; 2022 Bikram Dhoju. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>





  </body>
</html>